# ğŸ¥ MEDSC Backend

Backend robusto desarrollado con **Flask** y **Python** para el sistema mÃ©dico MEDSC.

![Python](https://img.shields.io/badge/Python-3.8+-blue?logo=python)
![Flask](https://img.shields.io/badge/Flask-3.0+-black?logo=flask)
![SQLAlchemy](https://img.shields.io/badge/SQLAlchemy-2.0+-red?logo=sqlalchemy)
![Socket.IO](https://img.shields.io/badge/Socket.IO-5.0+-green?logo=socket.io)

---

## ğŸš€ CaracterÃ­sticas Principales

- ğŸŒ **API RESTful** completa
- ğŸ”’ **AutenticaciÃ³n JWT** segura
- ğŸ’¬ **Chat en tiempo real** con Socket.IO
- ğŸ—„ï¸ **Base de datos hÃ­brida** (MySQL + Supabase)
- ğŸ“Š **ORM avanzado** con SQLAlchemy
- ğŸ”„ **CORS configurado** para frontend
- ğŸ›¡ï¸ **ValidaciÃ³n robusta** de datos
- ğŸ“ **DocumentaciÃ³n automÃ¡tica** de API

---

## ğŸ› ï¸ Stack TecnolÃ³gico

### Backend Core
- **Flask 3.1+** - Framework web minimalista
- **Python 3.8+** - Lenguaje de programaciÃ³n
- **SQLAlchemy 2.0+** - ORM avanzado

### Base de Datos
- **MySQL** - Base de datos principal
- **Supabase** - Backend as a Service
- **PyMySQL** - Conector MySQL

### ComunicaciÃ³n en Tiempo Real
- **Flask-SocketIO** - WebSocket para Flask
- **Socket.IO** - Protocolo de comunicaciÃ³n bidireccional

### Seguridad & Utilidades
- **Flask-JWT-Extended** - AutenticaciÃ³n JWT
- **Flask-CORS** - Cross-Origin Resource Sharing
- **Bcrypt** - Hashing de contraseÃ±as
- **python-dotenv** - Variables de entorno

---

## ğŸ“‹ Prerequisitos

- **Python 3.8+**
- **MySQL** (o Docker)
- **Cuenta Supabase** (opcional pero recomendado)
- **pip** o **pipenv**

---

## ğŸš€ InstalaciÃ³n y ConfiguraciÃ³n

### 1. ConfiguraciÃ³n del Entorno

```bash
# Clonar repositorio y navegar al backend
cd MEDSC-Monolitica

# Crear entorno virtual
python -m venv venv

# Activar entorno virtual
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# Instalar dependencias
pip install -r app/requirements.txt
```

### 2. Variables de Entorno

Crear archivo `.env` en la raÃ­z:

```env
# Base de datos MySQL
MYSQL_USER=tu_usuario
MYSQL_PASSWORD=tu_contraseÃ±a
MYSQL_HOST=localhost
MYSQL_DATABASE=medsc_db
MYSQL_PORT=3306

# Supabase (recomendado)
SUPABASE_URL=https://tu-proyecto.supabase.co
SUPABASE_KEY=tu_supabase_anon_key

# JWT Secret
JWT_SECRET_KEY=tu_clave_secreta_muy_segura

# ConfiguraciÃ³n Flask
FLASK_ENV=development
FLASK_DEBUG=true
```

### 3. ConfiguraciÃ³n de Base de Datos

#### OpciÃ³n A: MySQL Local
```bash
# Instalar MySQL y crear base de datos
mysql -u root -p
CREATE DATABASE medsc_db;
```

#### OpciÃ³n B: MySQL con Docker
```bash
# Ejecutar MySQL en Docker
docker-compose up -d db
```

#### OpciÃ³n C: Solo Supabase
```bash
# El sistema funciona completamente con Supabase
# Solo configurar las variables SUPABASE_*
```

### 4. Ejecutar la AplicaciÃ³n

```bash
# Desde la carpeta MEDSC-Monolitica
python app/index.py
```

El servidor estarÃ¡ disponible en: **http://localhost:5000**

---

## ğŸ—ï¸ Estructura del Proyecto

```
MEDSC-Monolitica/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ routes/                 # Endpoints de la API
â”‚   â”‚   â”œâ”€â”€ login.py           # AutenticaciÃ³n
â”‚   â”‚   â”œâ”€â”€ clinic.py          # Rutas principales
â”‚   â”‚   â”œâ”€â”€ patients.py        # GestiÃ³n de pacientes
â”‚   â”‚   â”œâ”€â”€ attention.py       # AtenciÃ³n mÃ©dica
â”‚   â”‚   â””â”€â”€ chat.py            # Chat en tiempo real
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                # Modelos de base de datos
â”‚   â”‚   â””â”€â”€ models_flask.py    # DefiniciÃ³n de tablas
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                 # Utilidades
â”‚   â”‚   â”œâ”€â”€ db.py              # ConfiguraciÃ³n de DB
â”‚   â”‚   â””â”€â”€ supabase_client.py # Cliente Supabase
â”‚   â”‚
â”‚   â”œâ”€â”€ templates/             # Templates HTML (legado)
â”‚   â”œâ”€â”€ static/                # Archivos estÃ¡ticos
â”‚   â”‚
â”‚   â”œâ”€â”€ app.py                 # AplicaciÃ³n Flask principal
â”‚   â”œâ”€â”€ index.py               # Punto de entrada
â”‚   â”œâ”€â”€ config.py              # Configuraciones
â”‚   â””â”€â”€ requirements.txt       # Dependencias Python
â”‚
â”œâ”€â”€ docker-compose.yml         # ConfiguraciÃ³n Docker
â””â”€â”€ README.md                  # Este archivo
```

---

## ğŸŒ API Endpoints

### ğŸ” AutenticaciÃ³n
- `POST /login` - Iniciar sesiÃ³n
- `POST /logout` - Cerrar sesiÃ³n
- `GET /verify-token` - Verificar JWT

### ğŸ‘¥ Pacientes
- `GET /patients` - Listar pacientes
- `POST /patients` - Crear paciente
- `PUT /patients/{id}` - Actualizar paciente
- `DELETE /patients/{id}` - Eliminar paciente
- `GET /patients/{id}` - Obtener paciente especÃ­fico

### ğŸ¥ AtenciÃ³n MÃ©dica
- `POST /add-attention` - Crear nueva atenciÃ³n
- `POST /add-vital-signs` - Agregar signos vitales
- `POST /add-evaluation` - Agregar evaluaciÃ³n inicial
- `POST /add-physical-exam` - Agregar examen fÃ­sico
- `POST /add-diagnostic` - Agregar diagnÃ³stico
- `POST /add-treatment` - Agregar tratamiento
- `GET /get-attentions/{patient_id}` - Historial de atenciones

### ğŸ’¬ Chat
- `POST /send-message` - Enviar mensaje HTTP
- `GET /get-messages/{user_id}` - Obtener mensajes
- `GET /get-chat-doctors` - Listar doctores disponibles
- `WebSocket /socket.io/` - Chat en tiempo real

### ğŸ“Š Dashboard
- `GET /dashboard-stats` - EstadÃ­sticas generales
- `GET /recent-activity` - Actividad reciente

---

## ğŸ”§ Modelos de Base de Datos

### Principales Entidades
- **Patient** - InformaciÃ³n de pacientes
- **Doctor** - InformaciÃ³n de mÃ©dicos
- **Attention** - Consultas mÃ©dicas
- **ChatMessage** - Mensajes del chat
- **Diagnostic** - DiagnÃ³sticos mÃ©dicos
- **Treatment** - Tratamientos aplicados
- **Laboratory** - ExÃ¡menes de laboratorio
- **Imaging** - Estudios de imagen

### Relaciones
- Un paciente puede tener mÃºltiples atenciones
- Una atenciÃ³n puede tener mÃºltiples diagnÃ³sticos
- Los doctores pueden chatear con pacientes
- Historial completo de todas las interacciones

---

## ğŸ’¬ Chat en Tiempo Real

### CaracterÃ­sticas
- **WebSocket** con Socket.IO
- **Fallback HTTP** automÃ¡tico
- **Notificaciones** en tiempo real
- **Estado de conectividad** de usuarios
- **Persistencia** de mensajes en BD

### Eventos WebSocket
```python
# Eventos del servidor
@socketio.on('connect')
@socketio.on('disconnect')
@socketio.on('send_message')
@socketio.on('join_room')

# Eventos emitidos al cliente
emit('new_message', message_data)
emit('user_status', status_data)
emit('message_sent', confirmation)
```

---

## ğŸ”’ Seguridad Implementada

- âœ… **JWT Authentication** en todas las rutas protegidas
- âœ… **CORS configurado** especÃ­ficamente para el frontend
- âœ… **Bcrypt hashing** para contraseÃ±as
- âœ… **ValidaciÃ³n de entrada** en todos los endpoints
- âœ… **SanitizaciÃ³n** de datos SQL
- âœ… **Headers de seguridad** configurados

---

## ğŸ“Š Monitoreo y Logs

### Logging
```python
# ConfiguraciÃ³n de logs
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# Logs de eventos importantes
logger.info('User logged in')
logger.error('Database connection failed')
```

### MÃ©tricas (Futuro)
- Tiempo de respuesta de APIs
- Conectividad de WebSocket
- Uso de base de datos
- Errores y excepciones

---

## ğŸ³ Docker Support

```bash
# Ejecutar solo la base de datos
docker-compose up -d db

# Ejecutar toda la aplicaciÃ³n (futuro)
docker-compose up --build
```

---

## ğŸ§ª Testing

### Estructura de Tests
```bash
# Ejecutar tests unitarios
python -m pytest app/test_models.py

# Tests de modelos de base de datos
python app/test_models.py
```

---

## ğŸ”§ Desarrollo y Debugging

### Modo Debug
```bash
# Ejecutar en modo desarrollo
export FLASK_ENV=development
export FLASK_DEBUG=true
python app/index.py
```

### Herramientas Ãštiles
- **Flask Debug Toolbar** (desarrollo)
- **SQLAlchemy logging** para consultas
- **SocketIO debug** para WebSocket
- **Postman collection** para testing APIs

---

## ğŸ“ˆ Performance & Optimizaciones

- âš¡ **Connection pooling** en SQLAlchemy
- ğŸ—„ï¸ **Query optimization** con Ã­ndices
- ğŸ“¦ **Lazy loading** de relaciones
- ğŸ”„ **Async operations** con SocketIO
- ğŸ’¾ **Caching** estratÃ©gico (futuro)

---

## ğŸ¤ Contribuir

1. Fork el proyecto
2. Crea feature branch: `git checkout -b feature/nueva-api`
3. Commit cambios: `git commit -am 'Agrega nueva API'`
4. Push branch: `git push origin feature/nueva-api`
5. Crea Pull Request

---

## ğŸ“„ Licencia

Este proyecto es parte del sistema MEDSC bajo licencia MIT.

---

**Backend potente y escalable para el futuro de la medicina digital** ğŸš€
